# Specification: Simple Ticket Management System

**Version:** 0001  
**Date:** December 12, 2025  
**Status:** Draft

---

## 1. Overview

### 1.1 Purpose
This document specifies the requirements and design for a simple, tag-based ticket management system. The system allows a single user to create, organize, and track tickets using a flexible tagging system.

### 1.2 Scope
A lightweight web application for personal task and ticket management without the complexity of multi-user systems, authentication, or authorization.

### 1.3 Technology Stack
- **Database:** PostgreSQL
- **Frontend Framework:** Vite + React + TypeScript
- **Styling:** Tailwind CSS + shadcn/ui components
- **Backend:** Python with FastAPI
- **ORM:** SQLAlchemy
- **API Documentation:** Automatic OpenAPI/Swagger via FastAPI

---

## 2. Functional Requirements

### 2.1 Ticket Management

#### 2.1.1 Create Ticket
- **FR-1.1:** Users shall be able to create a new ticket with the following fields:
  - Title (required, max 200 characters)
  - Description (optional, rich text or markdown support)
  - Tags (optional, can be assigned during creation or added later)
  - Status (default: "Open")
  - Created timestamp (auto-generated)
  - Updated timestamp (auto-generated)

#### 2.1.2 Edit Ticket
- **FR-1.2:** Users shall be able to edit any existing ticket's title and description
- **FR-1.3:** The system shall automatically update the "updated timestamp" when a ticket is modified

#### 2.1.3 Delete Ticket
- **FR-1.4:** Users shall be able to permanently delete a ticket
- **FR-1.5:** The system should show a confirmation dialog before deletion
- **FR-1.6:** Deleting a ticket shall remove all associated tag relationships

#### 2.1.4 Complete/Uncomplete Ticket
- **FR-1.7:** Users shall be able to mark a ticket as "Completed"
- **FR-1.8:** Users shall be able to mark a "Completed" ticket back to "Open"
- **FR-1.9:** Completed tickets shall be visually distinguished (e.g., strikethrough, different color)
- **FR-1.10:** The completion status shall be stored as a boolean field in the database

### 2.2 Tag Management

#### 2.2.1 Add Tags to Ticket
- **FR-2.1:** Users shall be able to add one or multiple tags to a ticket
- **FR-2.2:** Users shall be able to create new tags on-the-fly when adding them to a ticket
- **FR-2.3:** Tag names shall be unique (case-insensitive)
- **FR-2.4:** Tags shall have the following properties:
  - Name (required, max 50 characters)
  - Color (optional, for visual distinction)
  - Created timestamp

#### 2.2.2 Remove Tags from Ticket
- **FR-2.5:** Users shall be able to remove any tag from a ticket
- **FR-2.6:** Removing a tag from a ticket shall not delete the tag from the system

#### 2.2.3 Tag Deletion
- **FR-2.7:** Users shall be able to delete tags from the system entirely
- **FR-2.8:** Deleting a tag shall remove it from all associated tickets
- **FR-2.9:** The system should show a confirmation dialog indicating how many tickets will be affected

### 2.3 Filtering and Search

#### 2.3.1 Filter by Tags
- **FR-3.1:** Users shall be able to view tickets filtered by one or multiple tags
- **FR-3.2:** When multiple tags are selected, the system shall show tickets that have ANY of the selected tags (OR logic)
- **FR-3.3:** Users shall be able to clear all filters to view all tickets
- **FR-3.4:** The system shall display a count of tickets for each tag

#### 2.3.2 Search by Title
- **FR-3.5:** Users shall be able to search tickets by title using a search input
- **FR-3.6:** Search shall be case-insensitive
- **FR-3.7:** Search shall support partial matching (e.g., "bug" matches "Bug fix" and "Debug issue")
- **FR-3.8:** Search can be combined with tag filters (AND logic: search AND tags)

#### 2.3.3 Filter by Status
- **FR-3.9:** Users shall be able to filter tickets by completion status (All, Open, Completed)

### 2.4 Ticket List Display

- **FR-4.1:** The system shall display tickets in a list or card view
- **FR-4.2:** Each ticket item shall show:
  - Title
  - Associated tags
  - Completion status
  - Created date
  - Action buttons (Edit, Delete, Complete/Uncomplete)
- **FR-4.3:** The list shall be sorted by updated timestamp (newest first) by default
- **FR-4.4:** The system shall display empty state messages when no tickets match the current filters

---

## 3. Non-Functional Requirements

### 3.1 Performance
- **NFR-1.1:** The application shall load the initial ticket list within 1 second
- **NFR-1.2:** Search and filter operations shall respond within 300ms
- **NFR-1.3:** The system shall handle up to 10,000 tickets without performance degradation

### 3.2 Usability
- **NFR-2.1:** The UI shall be responsive and work on desktop and tablet devices (mobile optimization optional)
- **NFR-2.2:** The interface shall use intuitive icons and clear labels
- **NFR-2.3:** All user actions shall provide immediate visual feedback

### 3.3 Reliability
- **NFR-3.1:** Database operations shall be transactional to prevent data loss
- **NFR-3.2:** The system shall validate all user inputs before database operations

### 3.4 Maintainability
- **NFR-4.1:** Code shall follow TypeScript best practices with proper typing
- **NFR-4.2:** Components shall be modular and reusable
- **NFR-4.3:** The database schema shall support future extensions (e.g., priorities, due dates)

---

## 4. Database Design

### 4.1 Schema

#### 4.1.1 Table: `tickets`
```sql
CREATE TABLE tickets (
  id SERIAL PRIMARY KEY,
  title VARCHAR(200) NOT NULL,
  description TEXT,
  is_completed BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_tickets_title ON tickets USING GIN (to_tsvector('english', title));
CREATE INDEX idx_tickets_completed ON tickets(is_completed);
CREATE INDEX idx_tickets_updated_at ON tickets(updated_at DESC);
```

#### 4.1.2 Table: `tags`
```sql
CREATE TABLE tags (
  id SERIAL PRIMARY KEY,
  name VARCHAR(50) UNIQUE NOT NULL,
  color VARCHAR(7), -- Hex color code, e.g., #FF5733
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_tags_name ON tags(name);
```

#### 4.1.3 Table: `ticket_tags` (Many-to-Many Relationship)
```sql
CREATE TABLE ticket_tags (
  ticket_id INTEGER NOT NULL REFERENCES tickets(id) ON DELETE CASCADE,
  tag_id INTEGER NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (ticket_id, tag_id)
);

CREATE INDEX idx_ticket_tags_ticket ON ticket_tags(ticket_id);
CREATE INDEX idx_ticket_tags_tag ON ticket_tags(tag_id);
```

### 4.2 Database Triggers

```sql
-- Auto-update updated_at timestamp
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = CURRENT_TIMESTAMP;
  RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_tickets_updated_at 
  BEFORE UPDATE ON tickets 
  FOR EACH ROW 
  EXECUTE FUNCTION update_updated_at_column();
```

---

## 5. API Design

**Field Naming Convention:**
- All API request and response JSON uses **camelCase** field names (e.g., `isCompleted`, `createdAt`, `tagIds`)
- Python backend code uses **snake_case** following PEP 8 (e.g., `is_completed`, `created_at`, `tag_ids`)
- Pydantic schemas use `serialization_alias` to automatically convert between the two formats

### 5.1 Ticket Endpoints

#### GET `/api/tickets`
Get all tickets with optional filters

**Query Parameters:**
- `search` (string): Search by title
- `tags` (string): Comma-separated tag IDs
- `status` (string): "all" | "open" | "completed"

**Response:**
```json
{
  "tickets": [
    {
      "id": 1,
      "title": "Fix login bug",
      "description": "Users cannot log in with special characters",
      "isCompleted": false,
      "createdAt": "2025-12-01T10:30:00Z",
      "updatedAt": "2025-12-01T10:30:00Z",
      "tags": [
        { "id": 1, "name": "bug", "color": "#FF0000" },
        { "id": 2, "name": "urgent", "color": "#FFA500" }
      ]
    }
  ]
}
```

#### POST `/api/tickets`
Create a new ticket

**Request Body:**
```json
{
  "title": "New feature request",
  "description": "Add dark mode support",
  "tagIds": [1, 3]
}
```

**Response:** Created ticket object (201 Created)

#### PUT `/api/tickets/:id`
Update a ticket

**Request Body:**
```json
{
  "title": "Updated title",
  "description": "Updated description",
  "isCompleted": true
}
```

**Response:** Updated ticket object (200 OK)

#### DELETE `/api/tickets/:id`
Delete a ticket

**Response:** 204 No Content

#### PATCH `/api/tickets/:id/complete`
Toggle ticket completion status

**Response:** Updated ticket object (200 OK)

### 5.2 Tag Endpoints

#### GET `/api/tags`
Get all tags with ticket counts

**Response:**
```json
{
  "tags": [
    {
      "id": 1,
      "name": "bug",
      "color": "#FF0000",
      "ticketCount": 5
    }
  ]
}
```

#### POST `/api/tags`
Create a new tag

**Request Body:**
```json
{
  "name": "feature",
  "color": "#00FF00"
}
```

**Response:** Created tag object (201 Created)

#### DELETE `/api/tags/:id`
Delete a tag

**Response:** 204 No Content

### 5.3 Ticket-Tag Relationship Endpoints

#### POST `/api/tickets/:id/tags`
Add tags to a ticket

**Request Body:**
```json
{
  "tagIds": [1, 2, 3]
}
```

**Response:** Updated ticket object (200 OK)

#### DELETE `/api/tickets/:ticketId/tags/:tagId`
Remove a tag from a ticket

**Response:** 204 No Content

---

## 6. UI/UX Design

### 6.1 Layout Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸŽ« Ticket Manager                    [+ New Ticket] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Sidebar    â”‚  â”‚  Main Content Area          â”‚  â”‚
â”‚  â”‚             â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  Tags       â”‚  â”‚  [Search: _____________]    â”‚  â”‚
â”‚  â”‚  â–¢ All (25) â”‚  â”‚  [Filter: All/Open/Done]    â”‚  â”‚
â”‚  â”‚  â–¢ bug (5)  â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  â–¢ feature  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚    (3)      â”‚  â”‚  â”‚ Ticket Card 1         â”‚  â”‚  â”‚
â”‚  â”‚  â–¢ urgent   â”‚  â”‚  â”‚ Title: Fix...         â”‚  â”‚  â”‚
â”‚  â”‚    (2)      â”‚  â”‚  â”‚ Tags: [bug] [urgent]  â”‚  â”‚  â”‚
â”‚  â”‚             â”‚  â”‚  â”‚ Created: 2d ago       â”‚  â”‚  â”‚
â”‚  â”‚  [+ Tag]    â”‚  â”‚  â”‚ [âœ“] [âœŽ] [âœ•]          â”‚  â”‚  â”‚
â”‚  â”‚             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚             â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚             â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚             â”‚  â”‚  â”‚ Ticket Card 2         â”‚  â”‚  â”‚
â”‚  â”‚             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Key Components

#### 6.2.1 Ticket Card Component
- **Visual State:**
  - Normal: White background, clear text
  - Completed: Gray background, strikethrough text, checkmark icon
  - Hover: Subtle shadow, highlight effect
- **Actions:**
  - Complete/Uncomplete toggle button
  - Edit button (opens modal/drawer)
  - Delete button (shows confirmation)

#### 6.2.2 Ticket Modal/Drawer
- **Create/Edit Form:**
  - Title input (large, prominent)
  - Description textarea (expandable)
  - Tag selector (multi-select with create option)
  - Save/Cancel buttons

#### 6.2.3 Sidebar Tag List
- **Display:**
  - Checkboxes for multi-select
  - Tag name with colored indicator
  - Ticket count badge
  - "All" option to clear filters
- **Actions:**
  - Click to toggle filter
  - Right-click or hover for delete option

#### 6.2.4 Search Bar
- **Features:**
  - Search icon
  - Placeholder text: "Search tickets by title..."
  - Clear button (when text is entered)
  - Real-time or debounced search

### 6.3 Color Palette (Tailwind)
- **Primary:** Blue-600 (action buttons)
- **Success:** Green-500 (complete state)
- **Danger:** Red-500 (delete actions)
- **Neutral:** Gray-100 to Gray-900 (backgrounds, text)
- **Tag Colors:** Customizable per tag

### 6.4 shadcn/ui Components to Use
- **Button:** For all action buttons
- **Input:** For title and search fields
- **Textarea:** For description
- **Checkbox:** For tag filters
- **Badge:** For displaying tags
- **Dialog:** For confirmation modals
- **Sheet/Drawer:** For ticket create/edit form
- **Command:** For tag selection with search
- **Separator:** For visual divisions
- **Toast:** For success/error notifications

---

## 7. User Workflows

### 7.1 Create a Ticket
1. User clicks "+ New Ticket" button
2. Modal/drawer opens with empty form
3. User enters title (required)
4. User optionally enters description
5. User optionally selects/creates tags
6. User clicks "Save"
7. System validates input
8. System creates ticket in database
9. System closes modal and refreshes list
10. System shows success toast notification

### 7.2 Filter Tickets by Tags
1. User views sidebar with all available tags
2. User clicks checkbox next to one or more tags
3. System immediately filters ticket list
4. System displays only tickets with selected tags
5. System updates UI to show active filters
6. User can click "All" to clear filters

### 7.3 Search and Filter Combined
1. User selects tag filters (e.g., "bug")
2. User types in search box (e.g., "login")
3. System shows tickets that have "bug" tag AND contain "login" in title
4. Results update in real-time or on debounce

### 7.4 Complete a Ticket
1. User clicks complete button (checkmark) on a ticket
2. System updates ticket status to completed
3. Ticket visual appearance changes (gray, strikethrough)
4. Ticket remains in list (if "All" or "Completed" filter is active)

### 7.5 Delete a Tag
1. User hovers over or right-clicks a tag in sidebar
2. User selects delete option
3. System shows confirmation: "Delete 'bug' tag? It will be removed from 5 tickets."
4. User confirms
5. System deletes tag from database
6. System removes tag from all associated tickets
7. System refreshes ticket list and tag sidebar

---

## 8. Project Directory Structure

### 8.1 Complete Project Layout

```
pmanager/
â”œâ”€â”€ README.md
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ specs/
â”‚   â””â”€â”€ 0001-spec.md
â”‚
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ requirements.txt             # Python dependencies
â”‚   â”œâ”€â”€ .env                         # Environment variables
â”‚   â”œâ”€â”€ alembic.ini                  # Alembic migration config
â”‚   â”œâ”€â”€ pyproject.toml               # Project configuration (optional)
â”‚   â”‚
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py                  # FastAPI app entry point
â”‚   â”‚   â”œâ”€â”€ config.py                # Configuration settings
â”‚   â”‚   â”œâ”€â”€ database.py              # Database connection and session
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ticket.py            # Ticket SQLAlchemy model
â”‚   â”‚   â”‚   â”œâ”€â”€ tag.py               # Tag SQLAlchemy model
â”‚   â”‚   â”‚   â””â”€â”€ ticket_tag.py        # Association table
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ticket.py            # Ticket Pydantic schemas
â”‚   â”‚   â”‚   â””â”€â”€ tag.py               # Tag Pydantic schemas
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ tickets.py           # Ticket endpoints
â”‚   â”‚   â”‚   â””â”€â”€ tags.py              # Tag endpoints
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ticket_service.py    # Ticket business logic
â”‚   â”‚   â”‚   â””â”€â”€ tag_service.py       # Tag business logic
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dependencies.py          # Dependency injection
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ logger.py            # Logging utility
â”‚   â”‚       â””â”€â”€ validators.py        # Custom validators
â”‚   â”‚
â”‚   â””â”€â”€ alembic/
â”‚       â”œâ”€â”€ env.py
â”‚       â”œâ”€â”€ script.py.mako
â”‚       â””â”€â”€ versions/
â”‚           â”œâ”€â”€ 001_create_tickets_table.py
â”‚           â”œâ”€â”€ 002_create_tags_table.py
â”‚           â”œâ”€â”€ 003_create_ticket_tags_table.py
â”‚           â””â”€â”€ 004_create_triggers.py
â”‚
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ postcss.config.js
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ favicon.ico
â”‚   â”‚
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.tsx                 # React entry point
â”‚       â”œâ”€â”€ App.tsx                  # Root component
â”‚       â”œâ”€â”€ vite-env.d.ts
â”‚       â”‚
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ ui/                  # shadcn/ui components
â”‚       â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ checkbox.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ sheet.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ command.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ separator.tsx
â”‚       â”‚   â”‚   â””â”€â”€ toast.tsx
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ layout/
â”‚       â”‚   â”‚   â”œâ”€â”€ Header.tsx       # App header with title and actions
â”‚       â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx      # Tag filter sidebar
â”‚       â”‚   â”‚   â””â”€â”€ Layout.tsx       # Main layout wrapper
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ ticket/
â”‚       â”‚   â”‚   â”œâ”€â”€ TicketCard.tsx           # Individual ticket display
â”‚       â”‚   â”‚   â”œâ”€â”€ TicketList.tsx           # List of tickets
â”‚       â”‚   â”‚   â”œâ”€â”€ TicketModal.tsx          # Create/edit ticket modal
â”‚       â”‚   â”‚   â”œâ”€â”€ TicketForm.tsx           # Ticket form component
â”‚       â”‚   â”‚   â”œâ”€â”€ TicketActions.tsx        # Action buttons (edit, delete, complete)
â”‚       â”‚   â”‚   â””â”€â”€ EmptyTicketState.tsx     # Empty state when no tickets
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ tag/
â”‚       â”‚   â”‚   â”œâ”€â”€ TagBadge.tsx             # Single tag badge display
â”‚       â”‚   â”‚   â”œâ”€â”€ TagList.tsx              # List of tags in sidebar
â”‚       â”‚   â”‚   â”œâ”€â”€ TagFilter.tsx            # Tag filter component
â”‚       â”‚   â”‚   â”œâ”€â”€ TagSelector.tsx          # Multi-select tag picker
â”‚       â”‚   â”‚   â”œâ”€â”€ TagCreateDialog.tsx      # Create new tag dialog
â”‚       â”‚   â”‚   â””â”€â”€ TagDeleteDialog.tsx      # Delete tag confirmation
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ common/
â”‚       â”‚       â”œâ”€â”€ SearchBar.tsx            # Search input component
â”‚       â”‚       â”œâ”€â”€ StatusFilter.tsx         # All/Open/Completed filter
â”‚       â”‚       â”œâ”€â”€ ConfirmDialog.tsx        # Reusable confirmation dialog
â”‚       â”‚       â””â”€â”€ LoadingSpinner.tsx       # Loading indicator
â”‚       â”‚
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ useTickets.ts        # Ticket data fetching and mutations
â”‚       â”‚   â”œâ”€â”€ useTags.ts           # Tag data fetching and mutations
â”‚       â”‚   â”œâ”€â”€ useFilters.ts        # Filter state management
â”‚       â”‚   â””â”€â”€ useDebounce.ts       # Debounce hook for search
â”‚       â”‚
â”‚       â”œâ”€â”€ services/
â”‚       â”‚   â”œâ”€â”€ api.ts               # Axios/fetch configuration
â”‚       â”‚   â”œâ”€â”€ ticketService.ts     # Ticket API calls
â”‚       â”‚   â””â”€â”€ tagService.ts        # Tag API calls
â”‚       â”‚
â”‚       â”œâ”€â”€ types/
â”‚       â”‚   â”œâ”€â”€ ticket.ts            # Ticket TypeScript types
â”‚       â”‚   â”œâ”€â”€ tag.ts               # Tag TypeScript types
â”‚       â”‚   â””â”€â”€ filter.ts            # Filter TypeScript types
â”‚       â”‚
â”‚       â”œâ”€â”€ store/                   # Optional: State management (Zustand/Redux)
â”‚       â”‚   â”œâ”€â”€ ticketStore.ts       # Ticket state store
â”‚       â”‚   â””â”€â”€ filterStore.ts       # Filter state store
â”‚       â”‚
â”‚       â”œâ”€â”€ lib/
â”‚       â”‚   â””â”€â”€ utils.ts             # shadcn/ui utils (cn function)
â”‚       â”‚
â”‚       â”œâ”€â”€ styles/
â”‚       â”‚   â”œâ”€â”€ globals.css          # Global styles and Tailwind imports
â”‚       â”‚   â””â”€â”€ variables.css        # CSS custom properties
â”‚       â”‚
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ dateFormatter.ts     # Date formatting utilities
â”‚           â”œâ”€â”€ colorGenerator.ts    # Tag color generation
â”‚           â””â”€â”€ validators.ts        # Client-side validation
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ conftest.py              # Pytest fixtures
â”‚   â”‚   â”œâ”€â”€ test_tickets.py          # Ticket endpoint tests
â”‚   â”‚   â””â”€â”€ test_tags.py             # Tag endpoint tests
â”‚   â”‚
â”‚   â””â”€â”€ client/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ TicketCard.test.tsx
â”‚       â”‚   â””â”€â”€ TagBadge.test.tsx
â”‚       â””â”€â”€ hooks/
â”‚           â””â”€â”€ useTickets.test.ts
â”‚
â””â”€â”€ scripts/
    â”œâ”€â”€ seed.py                      # Database seeding script
    â””â”€â”€ reset_db.py                  # Database reset script
```

### 8.2 Key Configuration Files

#### 8.2.1 Root `package.json` (for client)
```json
{
  "name": "pmanager",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev:client": "cd client && npm run dev",
    "build:client": "cd client && npm run build"
  }
}
```

#### 8.2.2 Server `requirements.txt`
```
fastapi==0.109.0
uvicorn[standard]==0.27.0
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
alembic==1.13.1
pydantic==2.5.3
pydantic-settings==2.1.0
python-dotenv==1.0.0
python-multipart==0.0.6
gunicorn==21.2.0

# Development dependencies (optional)
pytest==7.4.4
pytest-asyncio==0.23.3
httpx==0.26.0
```

#### 8.2.3 `.gitignore`
```
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/
.venv/

# Dependencies
node_modules/
client/node_modules/

# Environment variables
.env
.env.local
.env.*.local

# Build outputs
dist/
build/
client/dist/
*.egg-info/

# Logs
*.log
npm-debug.log*
logs/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Testing
coverage/
.pytest_cache/
.coverage
htmlcov/

# Temporary files
*.tmp
.cache/

# Database
*.db
*.sqlite3
```

#### 8.2.4 `.env.example`
```
# Database
DATABASE_URL=postgresql://username:password@localhost:5432/pmanager

# Server
HOST=0.0.0.0
PORT=8000
ENVIRONMENT=development
DEBUG=True

# CORS
ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173

# Security
SECRET_KEY=your-secret-key-here-change-in-production
```

### 8.3 Folder Organization Principles

#### 8.3.1 Separation of Concerns
- **Server folder:** All backend code (API, database, business logic)
- **Client folder:** All frontend code (React, UI components, styles)
- **Specs folder:** Documentation and specifications
- **Tests folder:** Test suites for both frontend and backend

#### 8.3.2 Component Organization
- **ui/**: Pure presentational components from shadcn/ui
- **layout/**: Structural components (header, sidebar, layout)
- **ticket/**: Feature-specific ticket components
- **tag/**: Feature-specific tag components
- **common/**: Shared/reusable components across features

#### 8.3.3 Backend Layers (FastAPI Architecture)
- **Models:** SQLAlchemy ORM models defining database schema
- **Schemas:** Pydantic models for request/response validation
- **Routers:** FastAPI route definitions for API endpoints
- **Services:** Business logic and database operations
- **Dependencies:** Dependency injection for database sessions, etc.

#### 8.3.4 State Management Strategy
- **Option 1:** React hooks with Context API (simpler, built-in)
- **Option 2:** Zustand (lightweight, modern state management)
- **Option 3:** React Query/TanStack Query (server state management)

### 8.4 Development Workflow

1. **Initial Setup:**
   ```bash
   # Backend setup
   cd server
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   pip install -r requirements.txt
   
   # Frontend setup
   cd ../client
   npm install
   ```

2. **Database Setup:**
   ```bash
   # Create database
   createdb pmanager
   
   # Run migrations (from server directory)
   cd server
   alembic upgrade head
   ```

3. **Run Development Servers:**
   ```bash
   # Terminal 1 - Backend (from server directory)
   cd server
   source venv/bin/activate
   uvicorn app.main:app --reload --port 8000
   # Backend runs on http://localhost:8000
   # API docs available at http://localhost:8000/docs
   
   # Terminal 2 - Frontend (from client directory)
   cd client
   npm run dev
   # Frontend runs on http://localhost:5173
   ```

4. **Build for Production:**
   ```bash
   # Build frontend
   cd client
   npm run build
   
   # Run backend in production mode
   cd ../server
   uvicorn app.main:app --host 0.0.0.0 --port 8000
   ```

### 8.5 Python Backend Code Examples

#### 8.5.1 FastAPI Main App (`app/main.py`)
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.config import settings
from app.database import engine
from app.models import ticket, tag
from app.routers import tickets, tags

# Create database tables
ticket.Base.metadata.create_all(bind=engine)
tag.Base.metadata.create_all(bind=engine)

app = FastAPI(
    title="Ticket Manager API",
    description="Simple tag-based ticket management system",
    version="1.0.0"
)

# CORS middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Include routers
app.include_router(tickets.router, prefix="/api/tickets", tags=["tickets"])
app.include_router(tags.router, prefix="/api/tags", tags=["tags"])

@app.get("/")
def read_root():
    return {"message": "Ticket Manager API"}
```

#### 8.5.2 Database Configuration (`app/database.py`)
```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from app.config import settings

engine = create_engine(settings.DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()

def get_db():
    """Dependency for database sessions"""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

#### 8.5.3 Ticket Model (`app/models/ticket.py`)
```python
from sqlalchemy import Column, Integer, String, Text, Boolean, DateTime, Table
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from app.database import Base

# Association table
ticket_tags = Table(
    'ticket_tags',
    Base.metadata,
    Column('ticket_id', Integer, ForeignKey('tickets.id', ondelete='CASCADE'), primary_key=True),
    Column('tag_id', Integer, ForeignKey('tags.id', ondelete='CASCADE'), primary_key=True),
    Column('created_at', DateTime(timezone=True), server_default=func.now())
)

class Ticket(Base):
    __tablename__ = "tickets"
    
    id = Column(Integer, primary_key=True, index=True)
    title = Column(String(200), nullable=False)
    description = Column(Text, nullable=True)
    is_completed = Column(Boolean, default=False, index=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
    
    # Relationships
    tags = relationship("Tag", secondary=ticket_tags, back_populates="tickets")
```

#### 8.5.4 Ticket Schema (`app/schemas/ticket.py`)
```python
from pydantic import BaseModel, Field, ConfigDict
from datetime import datetime
from typing import List, Optional

class TagBase(BaseModel):
    id: int
    name: str
    color: Optional[str] = None
    
    model_config = ConfigDict(from_attributes=True)

class TicketBase(BaseModel):
    title: str = Field(..., max_length=200)
    description: Optional[str] = None

class TicketCreate(TicketBase):
    tag_ids: Optional[List[int]] = Field(default=[], serialization_alias="tagIds")

class TicketUpdate(BaseModel):
    title: Optional[str] = Field(None, max_length=200)
    description: Optional[str] = None
    is_completed: Optional[bool] = Field(None, serialization_alias="isCompleted")

class TicketResponse(TicketBase):
    id: int
    is_completed: bool = Field(..., serialization_alias="isCompleted")
    created_at: datetime = Field(..., serialization_alias="createdAt")
    updated_at: datetime = Field(..., serialization_alias="updatedAt")
    tags: List[TagBase] = []
    
    model_config = ConfigDict(
        from_attributes=True,
        populate_by_name=True  # Allow both snake_case and camelCase for input
    )

class TicketsListResponse(BaseModel):
    """Wrapper for list of tickets to match API documentation"""
    tickets: List[TicketResponse]

class AddTagsRequest(BaseModel):
    """Request model for adding tags to a ticket"""
    tag_ids: List[int] = Field(..., serialization_alias="tagIds", alias="tagIds")
```

#### 8.5.5 Ticket Router (`app/routers/tickets.py`)
```python
from fastapi import APIRouter, Depends, HTTPException, Query
from sqlalchemy.orm import Session
from typing import List, Optional
from app.database import get_db
from app.schemas.ticket import TicketCreate, TicketUpdate, TicketResponse, TicketsListResponse, AddTagsRequest
from app.services import ticket_service

router = APIRouter()

@router.get("/", response_model=TicketsListResponse)
def get_tickets(
    search: Optional[str] = Query(None),
    tags: Optional[str] = Query(None),
    status: Optional[str] = Query("all"),
    db: Session = Depends(get_db)
):
    """Get all tickets with optional filters"""
    tag_ids = [int(t) for t in tags.split(",")] if tags else None
    tickets = ticket_service.get_tickets(db, search, tag_ids, status)
    return TicketsListResponse(tickets=tickets)

@router.post("/", response_model=TicketResponse, status_code=201)
def create_ticket(ticket: TicketCreate, db: Session = Depends(get_db)):
    """Create a new ticket"""
    return ticket_service.create_ticket(db, ticket)

@router.put("/{ticket_id}", response_model=TicketResponse)
def update_ticket(ticket_id: int, ticket: TicketUpdate, db: Session = Depends(get_db)):
    """Update a ticket"""
    return ticket_service.update_ticket(db, ticket_id, ticket)

@router.delete("/{ticket_id}", status_code=204)
def delete_ticket(ticket_id: int, db: Session = Depends(get_db)):
    """Delete a ticket"""
    ticket_service.delete_ticket(db, ticket_id)
    return None

@router.patch("/{ticket_id}/complete", response_model=TicketResponse)
def toggle_complete(ticket_id: int, db: Session = Depends(get_db)):
    """Toggle ticket completion status"""
    return ticket_service.toggle_complete(db, ticket_id)

@router.post("/{ticket_id}/tags", response_model=TicketResponse)
def add_tags_to_ticket(
    ticket_id: int, 
    request: AddTagsRequest, 
    db: Session = Depends(get_db)
):
    """Add tags to a ticket"""
    return ticket_service.add_tags(db, ticket_id, request.tag_ids)

@router.delete("/{ticket_id}/tags/{tag_id}", status_code=204)
def remove_tag_from_ticket(ticket_id: int, tag_id: int, db: Session = Depends(get_db)):
    """Remove a tag from a ticket"""
    ticket_service.remove_tag(db, ticket_id, tag_id)
    return None
```

#### 8.5.6 Tag Schema (`app/schemas/tag.py`)
```python
from pydantic import BaseModel, Field, ConfigDict
from datetime import datetime
from typing import Optional

class TagBase(BaseModel):
    id: int
    name: str
    color: Optional[str] = None

class TagCreate(BaseModel):
    name: str = Field(..., max_length=50)
    color: Optional[str] = Field(None, pattern=r'^#[0-9A-Fa-f]{6}$')

class TagUpdate(BaseModel):
    name: Optional[str] = Field(None, max_length=50)
    color: Optional[str] = Field(None, pattern=r'^#[0-9A-Fa-f]{6}$')

class TagResponse(TagBase):
    created_at: datetime = Field(..., serialization_alias="createdAt")
    
    model_config = ConfigDict(
        from_attributes=True,
        populate_by_name=True
    )

class TagWithCount(TagBase):
    ticket_count: int = Field(..., serialization_alias="ticketCount")
    
    model_config = ConfigDict(
        from_attributes=True,
        populate_by_name=True
    )

class TagsListResponse(BaseModel):
    """Wrapper for list of tags to match API documentation"""
    tags: List[TagWithCount]
```

**Note on Field Naming:** 
- Python code uses snake_case (`is_completed`, `created_at`) following PEP 8
- API responses use camelCase (`isCompleted`, `createdAt`) following JavaScript conventions
- Pydantic `serialization_alias` ensures proper JSON serialization
- `populate_by_name=True` allows accepting both formats for flexibility

#### 8.5.7 Tag Router (`app/routers/tags.py`)
```python
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from typing import List
from app.database import get_db
from app.schemas.tag import TagCreate, TagUpdate, TagResponse, TagWithCount, TagsListResponse
from app.services import tag_service

router = APIRouter()

@router.get("/", response_model=TagsListResponse)
def get_tags(db: Session = Depends(get_db)):
    """Get all tags with ticket counts"""
    tags = tag_service.get_tags_with_counts(db)
    return TagsListResponse(tags=tags)

@router.post("/", response_model=TagResponse, status_code=201)
def create_tag(tag: TagCreate, db: Session = Depends(get_db)):
    """Create a new tag"""
    return tag_service.create_tag(db, tag)

@router.put("/{tag_id}", response_model=TagResponse)
def update_tag(tag_id: int, tag: TagUpdate, db: Session = Depends(get_db)):
    """Update a tag"""
    return tag_service.update_tag(db, tag_id, tag)

@router.delete("/{tag_id}", status_code=204)
def delete_tag(tag_id: int, db: Session = Depends(get_db)):
    """Delete a tag"""
    tag_service.delete_tag(db, tag_id)
    return None
```

**Note:** The GET `/api/tags` endpoint uses `TagWithCount` schema to include the `ticketCount` field in the response. The service layer should use a query like:
```python
# In tag_service.py
def get_tags_with_counts(db: Session):
    from sqlalchemy import func
    from app.models.ticket import ticket_tags
    
    tags = db.query(
        Tag,
        func.count(ticket_tags.c.ticket_id).label('ticket_count')
    ).outerjoin(
        ticket_tags, Tag.id == ticket_tags.c.tag_id
    ).group_by(Tag.id).all()
    
    return [
        TagWithCount(
            id=tag.id,
            name=tag.name,
            color=tag.color,
            ticket_count=count
        )
        for tag, count in tags
    ]
```

#### 8.5.8 Configuration (`app/config.py`)
```python
from pydantic_settings import BaseSettings
from typing import List

class Settings(BaseSettings):
    DATABASE_URL: str
    HOST: str = "0.0.0.0"
    PORT: int = 8000
    ENVIRONMENT: str = "development"
    DEBUG: bool = True
    ALLOWED_ORIGINS: List[str] = ["http://localhost:5173"]
    SECRET_KEY: str
    
    class Config:
        env_file = ".env"

settings = Settings()
```

---

## 9. Implementation Phases

### Phase 1: Core Infrastructure (Week 1)
- Set up Vite + React + TypeScript project
- Configure Tailwind CSS and shadcn/ui
- Set up Python virtual environment and FastAPI project
- Configure SQLAlchemy and Alembic
- Set up PostgreSQL database and create schema
- Implement basic FastAPI app with CORS and database connection

### Phase 2: Basic Ticket CRUD (Week 2)
- Implement ticket creation API and UI
- Implement ticket list display
- Implement ticket edit functionality
- Implement ticket deletion with confirmation
- Implement complete/uncomplete toggle

### Phase 3: Tag System (Week 3)
- Implement tag creation and management
- Implement tag assignment to tickets
- Display tags on ticket cards
- Implement tag deletion with cascade

### Phase 4: Filtering and Search (Week 4)
- Implement tag-based filtering
- Implement title search functionality
- Implement status filtering (All/Open/Completed)
- Combine multiple filters with proper logic

### Phase 5: Polish and UX (Week 5)
- Add loading states and spinners
- Add empty states
- Add error handling and validation
- Add toast notifications
- Improve responsive design
- Add animations and transitions

### Phase 6: Testing and Optimization (Week 6)
- Write unit tests for API endpoints
- Write integration tests for key workflows
- Optimize database queries
- Add proper indexing
- Performance testing and optimization

---

## 9. Future Enhancements (Out of Scope for v1)

- **Priorities:** Add priority levels (Low, Medium, High, Critical)
- **Due Dates:** Add due date tracking and overdue indicators
- **Sorting Options:** Sort by date, title, priority
- **Bulk Operations:** Select multiple tickets for bulk actions
- **Export/Import:** Export tickets to CSV/JSON
- **Attachments:** Attach files to tickets
- **Comments:** Add comment threads to tickets
- **Dark Mode:** System-wide dark theme
- **Keyboard Shortcuts:** Quick actions via keyboard
- **Ticket Templates:** Pre-defined ticket templates
- **Statistics Dashboard:** Visual analytics and charts
- **Multi-user Support:** Add authentication and user management
- **Real-time Updates:** WebSocket for live updates

---

## 10. Security Considerations

### 10.1 Input Validation
- Sanitize all user inputs to prevent SQL injection
- Validate title length (max 200 chars)
- Validate tag name length (max 50 chars)
- Validate color format for tags

### 10.2 Data Protection
- Use parameterized queries for all database operations
- Implement rate limiting on API endpoints
- Add CORS configuration for frontend-backend communication

### 10.3 Error Handling
- Never expose database errors to the frontend
- Log errors server-side for debugging
- Return user-friendly error messages

---

## 11. Deployment Considerations

### 11.1 Environment Variables
```
DATABASE_URL=postgresql://user:password@localhost:5432/ticketdb
PORT=3000
NODE_ENV=production
```

### 11.2 Database Migrations
- Use a migration tool (e.g., node-pg-migrate, Prisma Migrate)
- Version control all migration scripts
- Test migrations on staging before production

### 11.3 Build and Deploy
- Build frontend for production: `npm run build`
- Serve static files from backend or use CDN
- Use Gunicorn with Uvicorn workers for production: `gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker`
- Configure reverse proxy (e.g., Nginx)
- Consider containerization with Docker

---

## 12. Success Metrics

- **User Satisfaction:** Users can complete all core workflows without confusion
- **Performance:** All operations complete within specified time limits
- **Reliability:** Zero data loss incidents
- **Code Quality:** >80% test coverage, no critical linter errors
- **Maintainability:** New features can be added without refactoring core systems

---

## Appendix A: Glossary

- **Ticket:** A work item or task that needs to be tracked
- **Tag:** A label used to categorize tickets
- **Completion Status:** Whether a ticket is open or completed
- **Filter:** Mechanism to narrow down visible tickets

## Appendix B: References

- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Vite Documentation](https://vitejs.dev/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [shadcn/ui Documentation](https://ui.shadcn.com/)
- [React Documentation](https://react.dev/)

---

**Document Control**

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 0001 | 2025-12-12 | System | Initial draft |


