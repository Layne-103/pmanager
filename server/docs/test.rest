###
# Ticket Manager API - REST Client Tests
#
# Instructions:
# 1. Install REST Client extension in VS Code
# 2. Update the @baseUrl variable if your server runs on a different port
# 3. Click "Send Request" above each request to execute it
# 4. Run requests in order for proper test data setup
###

@baseUrl = http://localhost:8000

###############################################################################
# Health Check
###############################################################################

### Health Check
GET {{baseUrl}}/health

### Root Endpoint
GET {{baseUrl}}/


###############################################################################
# Tag Management
###############################################################################

### 1. Get all tags (initially empty)
GET {{baseUrl}}/api/tags/

### 2. Create tag - Bug
POST {{baseUrl}}/api/tags/
Content-Type: application/json

{
  "name": "Bug",
  "color": "#ef4444"
}

### 3. Create tag - Feature
POST {{baseUrl}}/api/tags/
Content-Type: application/json

{
  "name": "Feature",
  "color": "#3b82f6"
}

### 4. Create tag - Documentation
POST {{baseUrl}}/api/tags/
Content-Type: application/json

{
  "name": "Documentation",
  "color": "#10b981"
}

### 5. Create tag - Enhancement
POST {{baseUrl}}/api/tags/
Content-Type: application/json

{
  "name": "Enhancement",
  "color": "#8b5cf6"
}

### 6. Create tag - Security
POST {{baseUrl}}/api/tags/
Content-Type: application/json

{
  "name": "Security",
  "color": "#f59e0b"
}

### 7. Get all tags with ticket counts
GET {{baseUrl}}/api/tags/

### 8. Get single tag by ID (replace with actual ID)
GET {{baseUrl}}/api/tags/1

### 9. Update tag
PUT {{baseUrl}}/api/tags/1
Content-Type: application/json

{
  "name": "Critical Bug",
  "color": "#dc2626"
}

### 10. Update tag - only color
PUT {{baseUrl}}/api/tags/2
Content-Type: application/json

{
  "color": "#2563eb"
}

### 11. Delete tag
DELETE {{baseUrl}}/api/tags/5


###############################################################################
# Tag Error Cases
###############################################################################

### Error: Create duplicate tag (should fail)
POST {{baseUrl}}/api/tags/
Content-Type: application/json

{
  "name": "Bug",
  "color": "#ef4444"
}

### Error: Invalid color format (should fail)
POST {{baseUrl}}/api/tags/
Content-Type: application/json

{
  "name": "NewTag",
  "color": "red"
}

### Error: Get non-existent tag (should return 404)
GET {{baseUrl}}/api/tags/9999


###############################################################################
# Ticket Management
###############################################################################

### 1. Get all tickets (initially empty)
GET {{baseUrl}}/api/tickets/

### 2. Create ticket with tags
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Fix login authentication bug",
  "description": "Users cannot login with special characters in their passwords",
  "tagIds": [1, 4]
}

### 3. Create ticket without tags
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Implement user profile page",
  "description": "Create a new page where users can view and edit their profile information"
}

### 4. Create ticket with description and tags
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Update API documentation",
  "description": "Add examples and improve clarity of API documentation",
  "tagIds": [3]
}

### 5. Create ticket - minimal
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Refactor database queries"
}

### 6. Create ticket - security issue
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Fix XSS vulnerability in comment section",
  "description": "Sanitize user input to prevent XSS attacks",
  "tagIds": [1, 4]
}

### 7. Get all tickets
GET {{baseUrl}}/api/tickets/

### 8. Get single ticket by ID
GET {{baseUrl}}/api/tickets/1

### 9. Update ticket - title and description
PUT {{baseUrl}}/api/tickets/1
Content-Type: application/json

{
  "title": "Fix critical login authentication bug",
  "description": "Users cannot login with special characters in their passwords. This is affecting 30% of users."
}

### 10. Update ticket - mark as completed
PUT {{baseUrl}}/api/tickets/1
Content-Type: application/json

{
  "isCompleted": true
}

### 11. Update ticket - only title
PUT {{baseUrl}}/api/tickets/2
Content-Type: application/json

{
  "title": "Implement user profile page with avatar upload"
}

### 12. Toggle ticket completion status
PATCH {{baseUrl}}/api/tickets/2/complete

### 13. Toggle ticket completion status again (mark incomplete)
PATCH {{baseUrl}}/api/tickets/2/complete

### 14. Delete ticket
DELETE {{baseUrl}}/api/tickets/4


###############################################################################
# Ticket Tag Operations
###############################################################################

### 1. Add tags to ticket
POST {{baseUrl}}/api/tickets/2/tags
Content-Type: application/json

{
  "tagIds": [2, 3]
}

### 2. Add more tags to ticket
POST {{baseUrl}}/api/tickets/3/tags
Content-Type: application/json

{
  "tagIds": [1, 2]
}

### 3. Remove tag from ticket
DELETE {{baseUrl}}/api/tickets/1/tags/4

### 4. Remove another tag from ticket
DELETE {{baseUrl}}/api/tickets/2/tags/3


###############################################################################
# Filtering and Search
###############################################################################

### 1. Filter by status - all tickets
GET {{baseUrl}}/api/tickets/?status=all

### 2. Filter by status - open tickets only
GET {{baseUrl}}/api/tickets/?status=open

### 3. Filter by status - completed tickets only
GET {{baseUrl}}/api/tickets/?status=completed

### 4. Search by text in title
GET {{baseUrl}}/api/tickets/?search=login

### 5. Search by text in description
GET {{baseUrl}}/api/tickets/?search=documentation

### 6. Search case-insensitive
GET {{baseUrl}}/api/tickets/?search=API

### 7. Filter by single tag
GET {{baseUrl}}/api/tickets/?tags=1

### 8. Filter by multiple tags (OR logic)
GET {{baseUrl}}/api/tickets/?tags=1,2

### 9. Combine filters - search + status
GET {{baseUrl}}/api/tickets/?search=bug&status=open

### 10. Combine filters - search + tags
GET {{baseUrl}}/api/tickets/?search=user&tags=2

### 11. Combine filters - status + tags
GET {{baseUrl}}/api/tickets/?status=open&tags=1

### 12. Combine all filters
GET {{baseUrl}}/api/tickets/?search=fix&status=open&tags=1,2


###############################################################################
# Ticket Error Cases
###############################################################################

### Error: Invalid tag IDs (non-numeric)
GET {{baseUrl}}/api/tickets/?tags=abc,xyz

### Error: Mixed valid and invalid tag IDs
GET {{baseUrl}}/api/tickets/?tags=1,abc,2

### Error: Create ticket without title (should fail)
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "description": "This has no title"
}

### Error: Create ticket with title too long (should fail)
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat duis aute irure dolor"
}

### Error: Get non-existent ticket (should return 404)
GET {{baseUrl}}/api/tickets/9999

### Error: Update non-existent ticket (should return 404)
PUT {{baseUrl}}/api/tickets/9999
Content-Type: application/json

{
  "title": "Updated title"
}

### Error: Delete non-existent ticket (should return 404)
DELETE {{baseUrl}}/api/tickets/9999

### Error: Add tags to non-existent ticket (should return 404)
POST {{baseUrl}}/api/tickets/9999/tags
Content-Type: application/json

{
  "tagIds": [1, 2]
}

### Error: Remove tag from non-existent ticket (should return 404)
DELETE {{baseUrl}}/api/tickets/9999/tags/1


###############################################################################
# Complex Scenarios
###############################################################################

### Scenario 1: Create ticket and immediately complete it
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Quick task - Update logo",
  "tagIds": [3]
}

### Then mark it complete
PATCH {{baseUrl}}/api/tickets/6/complete

### Scenario 2: Create ticket, add tags, then remove one
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Implement caching layer"
}

### Add tags
POST {{baseUrl}}/api/tickets/7/tags
Content-Type: application/json

{
  "tagIds": [2, 4]
}

### Remove one tag
DELETE {{baseUrl}}/api/tickets/7/tags/4

### Scenario 3: Update ticket multiple times
POST {{baseUrl}}/api/tickets/
Content-Type: application/json

{
  "title": "Initial title"
}

### First update
PUT {{baseUrl}}/api/tickets/8
Content-Type: application/json

{
  "title": "Updated title",
  "description": "Added description"
}

### Second update
PUT {{baseUrl}}/api/tickets/8
Content-Type: application/json

{
  "description": "Updated description with more details",
  "isCompleted": true
}


###############################################################################
# Cleanup (Optional - run at the end to clean test data)
###############################################################################

### Delete all test tickets (run individually with actual IDs)
# DELETE {{baseUrl}}/api/tickets/1
# DELETE {{baseUrl}}/api/tickets/2
# DELETE {{baseUrl}}/api/tickets/3

### Delete all test tags (run individually with actual IDs)
# DELETE {{baseUrl}}/api/tags/1
# DELETE {{baseUrl}}/api/tags/2
# DELETE {{baseUrl}}/api/tags/3


###############################################################################
# API Documentation
###############################################################################

### Open Swagger UI in browser
# http://localhost:8000/docs

### Get OpenAPI JSON schema
GET {{baseUrl}}/openapi.json
